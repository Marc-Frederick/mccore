#                            -*- Mode: Makefile -*-
# Makefile.in
# Copyright © 2000-04 Laboratoire de Biologie Informatique et Théorique.
#                     Université de Montréal.
# Author           : Martin Larose <larosem@iro.umontreal.ca>
# Created On       : Tue Sep 19 18:57:11 2000
# $Revision: 1.49 $
# $Id: Makefile.in,v 1.49 2004-08-24 19:40:58 gendrop Exp $
# 
# This file is part of mccore.
# 
# mccore is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 2.1 of the License, or (at your option) any later version.
# 
# mccore is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
# 
# You should have received a copy of the GNU Lesser General Public
# License along with mccore; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA


PACKAGE = @PACKAGE@
VERSION = @VERSION@

srcdir = @srcdir@
VPATH = @srcdir@

prefix = @prefix@
exec_prefix = @exec_prefix@
datadir = @datadir@
includedir = @includedir@
libdir = @libdir@

CXX = @CXX@
CXXFLAGS = @CXXFLAGS@
DEPFLAGS = @DEPFLAGS@
DEFS = @DEFS@
LD = @CXX@
LINKOPTIONS = @LINKOPTIONS@
LDNAMEPARAM = @LDNAMEPARAM@
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@
LIBALLFLAGSTART = @LIBALLFLAGSTART@
LIBALLFLAGSTOP = @LIBALLFLAGSTOP@

AR = @AR@
ARXX = @ARXX@
AROPTIONS = @AROPTIONS@

INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@
INSTALL_PROGRAM = @INSTALL_PROGRAM@

HAVE_XMLCPG = @HAVE_XMLCPG@

.SUFFIXES:

%.d: %.cc
	@ $(SHELL) -ec '$(CXX) $(DEPFLAGS) $(DEFS) -I.. -I$(srcdir) $< \
	    | sed '\''s/\($*\)\.o[ :]*/\1.o \1.lo $@ : /g'\'' > $@; \
	      [ -s $@ ] || rm -f $@'

%.o: %.cc
	$(CXX) $(CXXFLAGS) $(DEFS) -I.. -I$(srcdir) -c $<

% : %.cc
% : %.o

ifeq ($(HAVE_XMLCPG),true)
        XMLCPG_SOURCES = RnamlReader.cc \
		   	 RnamlWriter.cc	
else
	XMLCPG_SOURCES = 
endif



SOURCES = $(XMLCPG_SOURCES) \
	  Binstream.cc \
	  Exception.cc \
	  Fastastream.cc \
	  Genbankstream.cc \
	  Messagestream.cc \
	  PdbFileHeader.cc \
	  Pdbstream.cc \
	  ServerSocket.cc \
	  Sequence.cc \
	  sockstream.cc \
	  zstream.cc \
\
	  Vector3D.cc \
	  HomogeneousTransfo.cc \
\
	  AtomType.cc \
	  AtomTypeStore.cc \
	  Atom.cc \
	  AtomSet.cc \
\
	  PropertyType.cc \
	  PropertyTypeStore.cc \
\
	  ResId.cc \
	  ResIdSet.cc \
	  ResidueType.cc \
	  ResidueTypeStore.cc \
	  Residue.cc \
	  ExtendedResidue.cc \
	  ResidueFactoryMethod.cc \
	  ResidueTopology.cc \
\
	  HBond.cc \
	  Model.cc \
	  Molecule.cc \
\
	  Rmsd.cc \
	  Relation.cc \
	  PairingPattern.cc \
\
          RiboseBuilder.cc \
          RiboseOptimizer5D.cc \
          RiboseOptimizer2D.cc \
          RiboseEstimator.cc


HEADERS = $(SOURCES:.cc=.h) AbstractGraph.h AdjacencyMatrix.h Algo.h \
ArrayGraph.h Graph.h GraphAlgo.h MaximumFlowGraph.h Path.h \
SocketCommand.h SymmetricalMatrix.h SymmetricalMatrix.cc \
UndirectedArrayGraph.h UndirectedGraph.h stlio.h


OBJECTS = $(SOURCES:.cc=.o)

LIBRARY = lib$(PACKAGE)

DISTFILES = Makefile.in $(SOURCES) $(HEADERS)


all: $(LIBRARY).so.$(VERSION) TAGS

static: $(LIBRARY).a TAGS

$(LIBRARY).so.$(VERSION): $(OBJECTS)
	$(LD) $(LINKOPTIONS) -o $@ $(LDNAMEPARAM)$@ $^ $(LDFLAGS) $(LIBS)

$(LIBRARY).a: $(OBJECTS)
	$(ARXX) $(AROPTIONS) $@ $^

TAGS: $(SOURCES) $(HEADERS)
	@- etags --c++ $^


doc: html texi docbook

html: $(HEADERS)
	@- kdoc -f html -d ../docs/html -p --strip-h-path -n $(LIBRARY) -u "$(LIBRARY)" -z $^

texi: $(HEADERS)
	@- kdoc -f texinfo -d ../docs/texinfo -p --strip-h-path $^

docbook: $(HEADERS)
	@- kdoc -f docbook -d ../docs/docbook -p --strip-h-path $^



install: all
	@ echo Installing $(LIBRARY).so in $(libdir)
	@ $(srcdir)/../mkinstalldirs $(libdir)
	@ $(srcdir)/../mkinstalldirs $(includedir)/$(PACKAGE)-$(VERSION)
	@ $(INSTALL_DATA) $(LIBRARY).so.$(VERSION) $(libdir)/$(LIBRARY).so.$(VERSION)
	@ $(RM) $(libdir)/$(LIBRARY).so
	@ ln -s $(LIBRARY).so.$(VERSION) $(libdir)/$(LIBRARY).so
	@ echo Installing headers in $(includedir)/$(PACKAGE)-$(VERSION)
	@ for file in $(HEADERS); do \
           $(INSTALL_DATA) $(srcdir)/$$file $(includedir)/$(PACKAGE)-$(VERSION)/$$file; \
	  done
	@ $(RM) $(includedir)/$(PACKAGE)
	@ ln -s $(PACKAGE)-$(VERSION) $(includedir)/$(PACKAGE)

install-static: static
	@ echo Installing $(LIBRARY).a in $(libdir)
	@ $(srcdir)/../mkinstalldirs $(libdir)
	@ $(srcdir)/../mkinstalldirs $(includedir)/$(PACKAGE)-$(VERSION)
	@ $(INSTALL_DATA) $(LIBRARY).a $(libdir)/$(LIBRARY)-$(VERSION).a
	@ $(RM) $(libdir)/$(LIBRARY).a
	@ ln -s $(LIBRARY)-$(VERSION).a $(libdir)/$(LIBRARY).a
	@ echo Installing headers in $(includedir)/$(PACKAGE)-$(VERSION)
	@ for file in $(HEADERS); do \
           $(INSTALL_DATA) $(srcdir)/$$file $(includedir)/$(PACKAGE)-$(VERSION)/$$file; \
	  done;
	@ $(RM) $(includedir)/$(PACKAGE)
	@ ln -s $(PACKAGE)-$(VERSION) $(includedir)/$(PACKAGE)

uninstall:
	@ $(RM) $(libdir)/$(LIBRARY).a
	@ $(RM) $(libdir)/$(LIBRARY)-$(VERSION).a
	@ $(RM) $(libdir)/$(LIBRARY).so
	@ $(RM) $(libdir)/$(LIBRARY).so.$(VERSION)
	@ for file in $(HEADERS); do \
           $(RM) $(includedir)/$(PACKAGE)-$(VERSION)/$$file; \
          done;
	@- rmdir $(includedir)/$(PACKAGE)-$(VERSION)
	@ $(RM) $(includedir)/$(PACKAGE)


mostlyclean:
	@ $(RM) *~

clean: mostlyclean
	@ echo "Cleaning project"
	@ $(RM) $(LIBRARY).so $(LIBRARY).so.$(VERSION) $(LIBRARY).a
	@ $(RM) $(OBJECTS) TAGS
	@ $(RM) *.d

distclean: clean
	@ $(RM) Makefile stamp-h

topclean: distclean
	@ echo "The project is getting _top_ clean\!"

release: static

dist:
	@ echo "Copying distribution files"
	@ for file in $(DISTFILES); do \
	   ln $(srcdir)/$$file ../$(PACKAGE)-$(VERSION)/lib 2> /dev/null \
	    || cp -p $(srcdir)/$$file ../$(PACKAGE)$(VERSION)/lib; \
	  done

Makefile: $(srcdir)/Makefile.in ../config.status
	@ cd .. && ./config.status lib/$@

# Tell versions [3.59,3.63) of GNU make not to export all variables.
# Otherwise a system limit (for SysV at least) may be exceeded.
.NOEXPORT:

-include $(SOURCES:.cc=.d)
